function Gauge(b,i){var f=this;this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;this.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame;this.animationToken=null;this.canvas=b;function h(j){f.settings={value:j.value||0,valueFormat:j.valueFormat||null,pointerValue:j.value||0,label:j.label||"",unitsLabel:j.unitsLabel||"",min:j.min||0,max:j.max||100,majorTicks:j.majorTicks||5,minorTicks:j.minorTicks||2,bands:[].concat(j.bands||[]),greenFrom:[].concat(j.greenFrom||0),greenTo:[].concat(j.greenTo||0),yellowFrom:[].concat(j.yellowFrom||0),yellowTo:[].concat(j.yellowTo||0),redFrom:[].concat(j.redFrom||0),redTo:[].concat(j.redTo||0)};f.colors={text:j.colorOfText||"rgb(0, 0, 0)",warningText:j.colorOfWarningText||"rgb(255, 0, 0)",fill:j.colorOfFill||["#111","#ccc","#ddd","#eee"],pointerFill:j.colorOfPointerFill||"rgba(255, 100, 0, 0.7)",pointerStroke:j.colorOfPointerStroke||"rgba(255, 100, 100, 0.9)",centerCircleFill:j.colorOfCenterCircleFill||"rgba(0, 100, 255, 1)",centerCircleStroke:j.colorOfCenterCircleStroke||"rgba(0, 0, 255, 1)",redBand:j.colorOfRedBand||j.redColor||"rgba(255, 0, 0, 0.2)",yelBand:j.colorOfYellowBand||j.yellowColor||"rgba(255, 215, 0, 0.2)",grnBand:j.colorOfGreenBand||j.greenColor||"rgba(0, 255, 0, 0.2)"};for(var k=f.settings.redFrom.length;k--;){f.settings.bands.push({color:f.colors.redBand,from:f.settings.redFrom[k],to:f.settings.redTo[k]})}for(k=f.settings.yellowFrom.length;k--;){f.settings.bands.push({color:f.colors.yelBand,from:f.settings.yellowFrom[k],to:f.settings.yellowTo[k]})}for(k=f.settings.greenFrom.length;k--;){f.settings.bands.push({color:f.colors.grnBand,from:f.settings.greenFrom[k],to:f.settings.greenTo[k]})}f.relSettings=d(f.settings)}function d(j){var n,o=j.max-j.min,m=o/100,l;if(j.pointerValue>j.max){j.pointerValue=j.max}else{if(j.pointerValue<j.min){j.pointerValue=j.min}}l={min:0,max:100,value:(j.value-j.min)/m,pointerValue:(j.pointerValue-j.min)/m,label:j.label||"",greenFrom:[],greenTo:[],yellowFrom:[],yellowTo:[],redFrom:[],redTo:[],bands:[],majorTicks:Math.max(2,j.majorTicks),minorTicks:Math.max(0,j.minorTicks),decimals:Math.max(0,3-(j.max-j.min).toFixed(0).length)};for(n=j.bands.length;n--;){var k=j.bands[n];l.bands[n]={color:k.color,from:(k.from-j.min)/m,to:(k.to-j.min)/m}}return l}function e(k,l){var j;if(typeof f.settings.valueFormat=="function"){return f.settings.valueFormat(k,l)}j=k.toFixed(l);while((l>0)&&j.match(/^(-)?\d+\.(\d+)?0$/)){l-=1;j=k.toFixed(l)}return j}function a(j,k){j.font=k;j.mozTextStyle=k}function c(j,k){if(j.measureText){return j.measureText(k).width}else{if(j.mozMeasureText){return j.mozMeasureText(k)}}throw"measureText() not supported!"}function g(j,l,n,m){var k;if(j.fillText){return j.fillText(l,n,m)}else{if(j.mozDrawText){j.save();j.translate(n,m);k=j.mozDrawText(l);j.restore();return k}}throw"fillText() not supported!"}this.setOptions=h;this.setOptions(i||{});this.drawBackground=function(){var k=f.colors.fill,l=[this.radius,this.radius-1,this.radius*0.98,this.radius*0.95],j;this.c2d.rotate(this.startDeg);for(j=0;j<k.length;j++){this.c2d.fillStyle=k[j];this.c2d.beginPath();this.c2d.arc(0,0,l[j],0,this.spanDeg,false);this.c2d.fill()}};this.drawRange=function(k,j,m){if(j>k){var l=this.spanDeg*(j-k)/100;this.c2d.rotate(this.startDeg);this.c2d.fillStyle=m;this.c2d.rotate(this.spanDeg*k/100);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.arc(0,0,this.outerRadius,0,l,false);this.c2d.rotate(l);this.c2d.lineTo(this.innerRadius,0);this.c2d.arc(0,0,this.innerRadius,0,-l,true);this.c2d.fill()}};this.drawTicks=function(n,j){var m,l,o;this.c2d.rotate(this.startDeg);this.c2d.lineWidth=this.radius*0.025;m=this.spanDeg/(n-1);for(l=0;l<n;l++){this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke();if(l+1<n){this.c2d.save();this.c2d.lineWidth=this.radius*0.01;var k=m/(j+1);for(o=0;o<j;o++){this.c2d.rotate(k);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius+(this.outerRadius-this.innerRadius)/3,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke()}this.c2d.restore()}this.c2d.rotate(m)}};this.drawPointer=function(j){function k(l){l.c2d.beginPath();l.c2d.moveTo(-l.radius*0.2,0);l.c2d.lineTo(0,l.radius*0.05);l.c2d.lineTo(l.radius*0.8,0);l.c2d.lineTo(0,-l.radius*0.05);l.c2d.lineTo(-l.radius*0.2,0)}this.c2d.rotate(this.startDeg);this.c2d.rotate(this.spanDeg*j/100);this.c2d.lineWidth=this.radius*0.015;this.c2d.fillStyle=f.colors.pointerFill;k(this);this.c2d.fill();this.c2d.strokeStyle=f.colors.pointerStroke;k(this);this.c2d.stroke();this.c2d.fillStyle=f.colors.centerCircleFill;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.fill();this.c2d.strokeStyle=f.colors.centerCircleStroke;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.stroke()};this.drawCaption=function(n){if(n){var l=this.radius/5;a(this.c2d,l.toFixed(0)+"px sans-serif");var k=c(this.c2d,n);this.c2d.fillStyle=f.colors.text;var j=-k/2;var m=-this.radius*0.4+l/2;g(this.c2d,n,j,m)}};this.drawValues=function(k,p,o,q){var m,n,l,j;j=e(o,q)+f.settings.unitsLabel;n=this.radius/5;a(this.c2d,n.toFixed(0)+"px sans-serif");l=c(this.c2d,j);if(o<k||o>p){this.c2d.fillStyle=f.colors.warningText}else{this.c2d.fillStyle=f.colors.text}g(this.c2d,j,-l/2,this.radius*0.72);this.save();m=Math.PI*14.5/8;this.c2d.translate(this.radius*0.65*Math.sin(m),this.radius*0.65*Math.cos(m));n=this.radius/8;a(this.c2d,n.toFixed(0)+"px sans-serif");this.c2d.fillStyle=f.colors.text;g(this.c2d,e(k,q),0,0);this.restore();this.save();m=Math.PI*17.5/8;this.c2d.translate(this.radius*0.65*Math.sin(m),this.radius*0.65*Math.cos(m));n=this.radius/8;a(this.c2d,n.toFixed(0)+"px sans-serif");l=c(this.c2d,e(p,q));this.c2d.fillStyle=f.colors.text;g(this.c2d,e(p,q),-l,0);this.restore()};this.draw();return this}Gauge.prototype.setValue=function(c){var b=this,a=(c>b.settings.max)?b.settings.max:(c<b.settings.min)?b.settings.min:c,d=Math.abs(b.settings.pointerValue-a)/20;if(b.cancelRequestAnimFrame){b.cancelRequestAnimFrame(b.animationToken)}else{clearTimeout(b.animationToken)}function e(){var f;if(b.settings.pointerValue<a){b.settings.pointerValue+=d;if(b.settings.pointerValue+d>=a){b.settings.pointerValue=a}}else{b.settings.pointerValue-=d;if(b.settings.pointerValue-d<=a){b.settings.pointerValue=a}}f=b.settings.max-b.settings.min;b.relSettings.pointerValue=(b.settings.pointerValue-b.settings.min)/(f/100);b.draw();if(b.settings.pointerValue!=a){if(typeof b.requestAnimFrame!="undefined"){b.animationToken=b.requestAnimFrame.call(window,e)}else{b.animationToken=setTimeout(e,50)}}}if(!isNaN(c)&&this.settings.value!==c){this.settings.value=c;e()}};Gauge.prototype.draw=function(){var a,f,d;if(!this.canvas.getContext){return}var b={c2d:this.canvas.getContext("2d"),startDeg:Math.PI*5.5/8,spanDeg:Math.PI*13/8,save:function(){this.c2d.save()},restore:function(){this.c2d.restore()},call:function(h){var g=Array.prototype.slice.call(arguments);this.save();this.translateCenter();h.apply(this,g.slice(1));this.restore()},clear:function(){this.c2d.clearRect(0,0,this.width,this.height)},translateCenter:function(){this.c2d.translate(this.centerX,this.centerY)}};b.width=b.c2d.canvas.width;b.height=b.c2d.canvas.height;b.radius=Math.min(b.width/2-4,b.height/2-4);b.innerRadius=b.radius*0.7;b.outerRadius=b.radius*0.9;b.centerX=b.radius+4;b.centerY=b.radius+4+(b.radius-b.radius*Math.sin(b.startDeg))/2;b.clear();b.call(this.drawBackground);for(var e=this.relSettings.bands.length;e--;){var c=this.relSettings.bands[e];b.call(this.drawRange,c.from,c.to,c.color)}b.call(this.drawTicks,this.relSettings.majorTicks,this.relSettings.minorTicks);b.call(this.drawPointer,this.relSettings.pointerValue);b.call(this.drawCaption,this.relSettings.label);b.call(this.drawValues,this.settings.min,this.settings.max,this.settings.value,this.relSettings.decimals)};