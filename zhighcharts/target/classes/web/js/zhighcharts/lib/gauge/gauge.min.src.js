function Gauge(q,j){var m=this;this.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;this.cancelRequestAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame;this.animationToken=null;this.canvas=q;function k(b){m.settings={value:b.value||0,valueFormat:b.valueFormat||null,pointerValue:b.value||0,label:b.label||"",unitsLabel:b.unitsLabel||"",min:b.min||0,max:b.max||100,majorTicks:b.majorTicks||5,minorTicks:b.minorTicks||2,bands:[].concat(b.bands||[]),greenFrom:[].concat(b.greenFrom||0),greenTo:[].concat(b.greenTo||0),yellowFrom:[].concat(b.yellowFrom||0),yellowTo:[].concat(b.yellowTo||0),redFrom:[].concat(b.redFrom||0),redTo:[].concat(b.redTo||0)};m.colors={text:b.colorOfText||"rgb(0, 0, 0)",warningText:b.colorOfWarningText||"rgb(255, 0, 0)",fill:b.colorOfFill||["#111","#ccc","#ddd","#eee"],pointerFill:b.colorOfPointerFill||"rgba(255, 100, 0, 0.7)",pointerStroke:b.colorOfPointerStroke||"rgba(255, 100, 100, 0.9)",centerCircleFill:b.colorOfCenterCircleFill||"rgba(0, 100, 255, 1)",centerCircleStroke:b.colorOfCenterCircleStroke||"rgba(0, 0, 255, 1)",redBand:b.colorOfRedBand||b.redColor||"rgba(255, 0, 0, 0.2)",yelBand:b.colorOfYellowBand||b.yellowColor||"rgba(255, 215, 0, 0.2)",grnBand:b.colorOfGreenBand||b.greenColor||"rgba(0, 255, 0, 0.2)"};for(var a=m.settings.redFrom.length;a--;){m.settings.bands.push({color:m.colors.redBand,from:m.settings.redFrom[a],to:m.settings.redTo[a]})}for(a=m.settings.yellowFrom.length;a--;){m.settings.bands.push({color:m.colors.yelBand,from:m.settings.yellowFrom[a],to:m.settings.yellowTo[a]})}for(a=m.settings.greenFrom.length;a--;){m.settings.bands.push({color:m.colors.grnBand,from:m.settings.greenFrom[a],to:m.settings.greenTo[a]})}m.relSettings=o(m.settings)}function o(b){var d,c=b.max-b.min,e=c/100,f;if(b.pointerValue>b.max){b.pointerValue=b.max}else{if(b.pointerValue<b.min){b.pointerValue=b.min}}f={min:0,max:100,value:(b.value-b.min)/e,pointerValue:(b.pointerValue-b.min)/e,label:b.label||"",greenFrom:[],greenTo:[],yellowFrom:[],yellowTo:[],redFrom:[],redTo:[],bands:[],majorTicks:Math.max(2,b.majorTicks),minorTicks:Math.max(0,b.minorTicks),decimals:Math.max(0,3-(b.max-b.min).toFixed(0).length)};for(d=b.bands.length;d--;){var a=b.bands[d];f.bands[d]={color:a.color,from:(a.from-b.min)/e,to:(a.to-b.min)/e}}return f}function n(a,c){var b;if(typeof m.settings.valueFormat=="function"){return m.settings.valueFormat(a,c)}b=a.toFixed(c);while((c>0)&&b.match(/^(-)?\d+\.(\d+)?0$/)){c-=1;b=a.toFixed(c)}return b}function r(b,a){b.font=a;b.mozTextStyle=a}function p(b,a){if(b.measureText){return b.measureText(a).width}else{if(b.mozMeasureText){return b.mozMeasureText(a)}}throw"measureText() not supported!"}function l(b,e,c,d){var a;if(b.fillText){return b.fillText(e,c,d)}else{if(b.mozDrawText){b.save();b.translate(c,d);a=b.mozDrawText(e);b.restore();return a}}throw"fillText() not supported!"}this.setOptions=k;this.setOptions(j||{});this.drawBackground=function(){var a=m.colors.fill,c=[this.radius,this.radius-1,this.radius*0.98,this.radius*0.95],b;this.c2d.rotate(this.startDeg);for(b=0;b<a.length;b++){this.c2d.fillStyle=a[b];this.c2d.beginPath();this.c2d.arc(0,0,c[b],0,this.spanDeg,false);this.c2d.fill()}};this.drawRange=function(a,b,c){if(b>a){var d=this.spanDeg*(b-a)/100;this.c2d.rotate(this.startDeg);this.c2d.fillStyle=c;this.c2d.rotate(this.spanDeg*a/100);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.arc(0,0,this.outerRadius,0,d,false);this.c2d.rotate(d);this.c2d.lineTo(this.innerRadius,0);this.c2d.arc(0,0,this.innerRadius,0,-d,true);this.c2d.fill()}};this.drawTicks=function(d,b){var e,f,c;this.c2d.rotate(this.startDeg);this.c2d.lineWidth=this.radius*0.025;e=this.spanDeg/(d-1);for(f=0;f<d;f++){this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke();if(f+1<d){this.c2d.save();this.c2d.lineWidth=this.radius*0.01;var a=e/(b+1);for(c=0;c<b;c++){this.c2d.rotate(a);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius+(this.outerRadius-this.innerRadius)/3,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke()}this.c2d.restore()}this.c2d.rotate(e)}};this.drawPointer=function(b){function a(c){c.c2d.beginPath();c.c2d.moveTo(-c.radius*0.2,0);c.c2d.lineTo(0,c.radius*0.05);c.c2d.lineTo(c.radius*0.8,0);c.c2d.lineTo(0,-c.radius*0.05);c.c2d.lineTo(-c.radius*0.2,0)}this.c2d.rotate(this.startDeg);this.c2d.rotate(this.spanDeg*b/100);this.c2d.lineWidth=this.radius*0.015;this.c2d.fillStyle=m.colors.pointerFill;a(this);this.c2d.fill();this.c2d.strokeStyle=m.colors.pointerStroke;a(this);this.c2d.stroke();this.c2d.fillStyle=m.colors.centerCircleFill;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.fill();this.c2d.strokeStyle=m.colors.centerCircleStroke;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.stroke()};this.drawCaption=function(c){if(c){var e=this.radius/5;r(this.c2d,e.toFixed(0)+"px sans-serif");var a=p(this.c2d,c);this.c2d.fillStyle=m.colors.text;var b=-a/2;var d=-this.radius*0.4+e/2;l(this.c2d,c,b,d)}};this.drawValues=function(a,d,e,c){var g,f,h,b;b=n(e,c)+m.settings.unitsLabel;f=this.radius/5;r(this.c2d,f.toFixed(0)+"px sans-serif");h=p(this.c2d,b);if(e<a||e>d){this.c2d.fillStyle=m.colors.warningText}else{this.c2d.fillStyle=m.colors.text}l(this.c2d,b,-h/2,this.radius*0.72);this.save();g=Math.PI*14.5/8;this.c2d.translate(this.radius*0.65*Math.sin(g),this.radius*0.65*Math.cos(g));f=this.radius/8;r(this.c2d,f.toFixed(0)+"px sans-serif");this.c2d.fillStyle=m.colors.text;l(this.c2d,n(a,c),0,0);this.restore();this.save();g=Math.PI*17.5/8;this.c2d.translate(this.radius*0.65*Math.sin(g),this.radius*0.65*Math.cos(g));f=this.radius/8;r(this.c2d,f.toFixed(0)+"px sans-serif");h=p(this.c2d,n(d,c));this.c2d.fillStyle=m.colors.text;l(this.c2d,n(d,c),-h,0);this.restore()};this.draw();return this}Gauge.prototype.setValue=function(h){var i=this,j=(h>i.settings.max)?i.settings.max:(h<i.settings.min)?i.settings.min:h,g=Math.abs(i.settings.pointerValue-j)/20;if(i.cancelRequestAnimFrame){i.cancelRequestAnimFrame(i.animationToken)}else{clearTimeout(i.animationToken)}function f(){var a;if(i.settings.pointerValue<j){i.settings.pointerValue+=g;if(i.settings.pointerValue+g>=j){i.settings.pointerValue=j}}else{i.settings.pointerValue-=g;if(i.settings.pointerValue-g<=j){i.settings.pointerValue=j}}a=i.settings.max-i.settings.min;i.relSettings.pointerValue=(i.settings.pointerValue-i.settings.min)/(a/100);i.draw();if(i.settings.pointerValue!=j){if(typeof i.requestAnimFrame!="undefined"){i.animationToken=i.requestAnimFrame.call(window,f)}else{i.animationToken=setTimeout(f,50)}}}if(!isNaN(h)&&this.settings.value!==h){this.settings.value=h;f()}};Gauge.prototype.draw=function(){var l,g,i;if(!this.canvas.getContext){return}var k={c2d:this.canvas.getContext("2d"),startDeg:Math.PI*5.5/8,spanDeg:Math.PI*13/8,save:function(){this.c2d.save()},restore:function(){this.c2d.restore()},call:function(a){var b=Array.prototype.slice.call(arguments);this.save();this.translateCenter();a.apply(this,b.slice(1));this.restore()},clear:function(){this.c2d.clearRect(0,0,this.width,this.height)},translateCenter:function(){this.c2d.translate(this.centerX,this.centerY)}};k.width=k.c2d.canvas.width;k.height=k.c2d.canvas.height;k.radius=Math.min(k.width/2-4,k.height/2-4);k.innerRadius=k.radius*0.7;k.outerRadius=k.radius*0.9;k.centerX=k.radius+4;k.centerY=k.radius+4+(k.radius-k.radius*Math.sin(k.startDeg))/2;k.clear();k.call(this.drawBackground);for(var h=this.relSettings.bands.length;h--;){var j=this.relSettings.bands[h];k.call(this.drawRange,j.from,j.to,j.color)}k.call(this.drawTicks,this.relSettings.majorTicks,this.relSettings.minorTicks);k.call(this.drawPointer,this.relSettings.pointerValue);k.call(this.drawCaption,this.relSettings.label);k.call(this.drawValues,this.settings.min,this.settings.max,this.settings.value,this.relSettings.decimals)};